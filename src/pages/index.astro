---
import Layout from "../layouts/Layout.astro";
import { loadQuery } from "../sanity/lib/load-query";
import { type Post } from "../../sanity.types";
import Gallery from "../components/Gallery";

const { data: posts } = await loadQuery<Post[]>({
  query: `*[_type == "post"] {
    gallery
  }`,
});

// Extract all images from all posts and flatten them into a single array
const allImages = posts.flatMap((post) => post.gallery || []).filter(Boolean);

// Randomize the order of images on every render
const shuffledImages = [...allImages].sort(() => Math.random() - 0.5);
---

<Layout title="">
  <div class="w-full px-4 py-8">
    <header class="text-center mb-12">
      <h1 class="text-4xl font-bold mb-4 text-gray-900 dark:text-gray-100">
        weslley
      </h1>
      <p class="text-lg opacity-80 text-gray-700 dark:text-gray-300">
        blah blah, thrilling website. have a look around
      </p>
    </header>

    {
      shuffledImages.length > 0 ? (
        <Gallery client:load images={shuffledImages} />
      ) : (
        <div class="text-center py-16">
          <div class="text-6xl mb-4 opacity-40">ðŸ“¸</div>
          <h2 class="text-2xl font-semibold mb-2 opacity-70">No photos yet</h2>
          <p class="opacity-60">
            Upload some photos to your Sanity studio to see them here!
          </p>
        </div>
      )
    }

    <footer class="mt-16 text-center opacity-60">
      <div class="flex justify-center space-x-6 mb-4">
        <a
          href="http://instagram.com/weslley.co"
          target="_blank"
          class="hover:opacity-80 transition-opacity"
        >
          instagram
        </a>
        <a
          href="https://github.com/weslleyaraujo/"
          target="_blank"
          class="hover:opacity-80 transition-opacity"
        >
          github
        </a>
      </div>
    </footer>
  </div>
</Layout>
