---
interface Props {
  url: string;
  dimensions: number[];
}

function generateSrcSet(url: string, dimensions: number[], format: string) {
  return dimensions
    .map((width) => `${url}?w=${width}&fm=${format} ${width}w`)
    .join(", ");
}

const { url, dimensions } = Astro.props;
---

<picture>
  <!-- WebP format -->
  <source
    type="image/webp"
    srcset={generateSrcSet(url, dimensions, "webp")}
    sizes="(max-width: 640px) 100vw, (max-width: 1200px) 50vw, 33vw"
  />

  <!-- Default fallback image -->
  <img
    src={`${url}?w=${dimensions[0]}`}
    srcset={generateSrcSet(url, dimensions, "jpg")}
    sizes="(max-width: 640px) 100vw, (max-width: 1200px) 50vw, 33vw"
    alt="Responsive image"
    style="width: 100%; height: auto; object-fit: cover;"
    loading="lazy"
    decoding="async"
  />
</picture>
